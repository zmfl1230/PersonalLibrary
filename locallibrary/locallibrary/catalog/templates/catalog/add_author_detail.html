{% extends "catalog/base_generic.html" %}
{% load static %}

{% block content %}
<div class="row">
  <form class="col s12" >
    <div class="row">
        <div>"Who is the author you want to add?"</div>
    </div>

      <form id="id_ajax_upload_form"  enctype="multipart/form-data" method="POST">
          {% csrf_token %}
          {{ form.as_p }}
          <input formmethod="post" type="submit">Upload</input>
      </form>


      <div class="row">
          <div class="input-field col s12">
              <input id="first_name" type="text" class="validate">
              <label for="first_name">First name</label>
          </div>
          <div class="input-field col s12">
              <input id="last_name" type="text" class="validate">
              <label for="last_name">Last name</label>
          </div>
      </div>



      <button class="btn waves-effect waves-light brown lighten-3"  style="height: 40px;
    width: 120px;">Add
      <i class="material-icons left">fingerprint</i>
    </button>

  </form>




</div>

    <script>
        $( document ).ready( function() {
        $('#id_ajax_upload_form').submit(function(e){
                console.log("formdata");
                e.preventDefault();
                $form = $(this);
                const formData = new FormData(this);
                console.log("formdata", formData);
                $.ajax({
                    url: window.location.pathname,
                    type: 'POST',
                    data: formData,
                    success: function (response) {
                        $('.error').remove();
                        console.log(response)
                        if(response.error){
                            $.each(response.errors, function(name, error){
                                error = '<small class="text-muted error">' + error + '</small>'
                                $form.find('[name=' + name + ']').after(error);
                            })
                        }
                        else{
                            alert(response.message)
                            window.location = ""
                        }
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });
            });
        });
    </script>
{% endblock %}